<!doctype html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DEOS DIOS — Odor Genome Protocol™</title>

  <!-- Fonts + Tailwind CDN + Iconify -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Newsreader:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://code.iconify.design/3/3.1.0/iconify.min.js"></script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Inter','sans-serif'],
            serif: ['Newsreader','serif']
          },
          colors: {
            ddgold: '#C5A467'
          }
        }
      }
    }
  </script>

  <style>
    :root { --bg: #050505; --muted: #9b9b9b; --gold: #C5A467; }
    html,body{height:100%}
    body { margin:0; background:var(--bg); color:#fff; font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto; -webkit-font-smoothing:antialiased; }
    .glass { background: rgba(255,255,255,0.02); border:1px solid rgba(255,255,255,0.05); backdrop-filter: blur(8px); border-radius: 12px; }
    .glass-strong { background: rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.06); backdrop-filter: blur(10px); border-radius: 16px; }
    .option-btn { background: rgba(255,255,255,0.02); border:1px solid rgba(255,255,255,0.06); transition: all .14s; display:block; text-align:left; padding: .9rem 1rem; border-radius: 10px; color: rgba(255,255,255,0.88); }
    .option-btn:hover { background: rgba(255,255,255,0.04); border-color: rgba(255,255,255,0.14); transform: translateY(-2px); }
    .option-btn.selected { border:2px solid var(--gold); background: rgba(197,164,103,0.06); font-weight:600; box-shadow: 0 14px 40px rgba(197,164,103,0.06); transform: translateY(-4px); }
    .page-section { display: none; padding-bottom: 6rem; }
    .page-section.active { display: block; }
    .progress-track { height:10px; background: rgba(255,255,255,0.06); border-radius:999px; overflow:hidden; }
    .progress-fill { height:100%; width:0; background: linear-gradient(90deg,var(--gold), #d4b379); transition: width .24s; }
    .constellation-canvas { width:100%; height:100%; display:block; border-radius:12px; }
    .muted { color: rgba(255,255,255,0.6); }
    .brand-tag { letter-spacing: .45em; font-weight:600; color:var(--gold); }
    footer a { color: rgba(255,255,255,0.6); }
    /* marquee */
    .marquee-wrap { overflow:hidden; white-space:nowrap; }
    .marquee-inner { display:inline-block; animation: marquee 28s linear infinite; }
    @keyframes marquee { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }
    /* small responsive tweaks */
    @media (max-width: 780px) {
      .nav-desktop { display:none; }
    }
  </style>
</head>
<body>

  <!-- NAV -->
  <nav class="fixed top-6 left-1/2 -translate-x-1/2 z-50 w-full max-w-[92vw] flex items-center justify-between px-4 py-2 rounded-full border border-white/8 glass-strong">
    <div class="flex items-center gap-3 cursor-pointer" onclick="showPage('home')">
      <span class="iconify text-white" data-icon="lucide:sparkles" data-width="18"></span>
      <span class="text-sm font-serif italic">DEOS DIOS</span>
    </div>

    <div class="hidden md:flex items-center gap-6 nav-desktop">
      <a href="#protocol" class="text-xs text-white/60 hover:text-white" onclick="showPage('protocol')">Protocol</a>
      <a href="#manifesto" class="text-xs text-white/60 hover:text-white" onclick="showPage('manifesto')">Manifesto</a>
      <a href="#faq" class="text-xs text-white/60 hover:text-white" onclick="showPage('faq')">FAQ</a>
    </div>

    <div class="flex items-center gap-4">
      <!-- Start Profile CTA - premium gold -->
      <button id="startBtn" onclick="showPage('protocol')" class="px-5 py-2 rounded-full text-sm font-medium text-black" style="background: linear-gradient(180deg,var(--gold), #d4b379); box-shadow: 0 8px 30px rgba(197,164,103,0.12);">Start Profile</button>
    </div>
  </nav>

  <!-- HOME -->
  <div id="home-page" class="page-section active">
    <main class="relative z-10 pt-36 pb-12 px-6">
      <div class="container mx-auto max-w-7xl flex flex-col lg:flex-row items-center gap-16">
        <div class="flex-1 text-center lg:text-left">
          <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full border border-white/8 glass">
            <span class="text-[10px] text-white/60 uppercase tracking-wide">Odor Genome v1.0</span>
          </div>

          <h1 class="text-5xl md:text-7xl font-serif font-light leading-tight mt-6 mb-6">
            Decode your<br><span class="italic text-white/60">Odor Genome™</span>
          </h1>

          <p class="text-lg text-white/60 max-w-xl mx-auto lg:mx-0 mb-8">
            A science-first diagnostic that maps the biological, environmental, and behavioral signals behind your personal scent — then matches you to deodorants that actually make sense.
          </p>

          <div class="flex flex-col sm:flex-row items-center gap-4 justify-center lg:justify-start">
            <button id="heroStart" onclick="showPage('protocol')" class="px-7 py-3 rounded-full text-sm font-medium text-black" style="background: linear-gradient(180deg,var(--gold), #d4b379); box-shadow: 0 12px 38px rgba(197,164,103,0.12);">Start Profile</button>
          </div>

          <p class="mt-6 text-xs text-white/30 flex items-center gap-2 justify-center lg:justify-start">
            <span class="iconify" data-icon="lucide:check-circle" data-width="12"></span>
            Expert-curated taxonomy • dynamic learning engine
          </p>
        </div>

        <!-- Constellation / Visual -->
        <div class="flex-1 w-full relative">
          <div class="glass p-6 rounded-2xl" style="height:360px; overflow:hidden;">
            <canvas id="constellation" class="constellation-canvas"></canvas>
          </div>
          <div class="mt-4 grid grid-cols-2 gap-3 text-sm">
            <div class="p-3 rounded-lg glass">
              <div class="text-[10px] text-white/50 uppercase">BioChem</div>
              <div class="text-xs text-white/70">pH • microbiome indicators</div>
            </div>
            <div class="p-3 rounded-lg glass">
              <div class="text-[10px] text-white/50 uppercase">Stress</div>
              <div class="text-xs text-white/70">Reactive spikes • apocrine signals</div>
            </div>
            <div class="p-3 rounded-lg glass">
              <div class="text-[10px] text-white/50 uppercase">Activity</div>
              <div class="text-xs text-white/70">Heat load • motion</div>
            </div>
            <div class="p-3 rounded-lg glass">
              <div class="text-[10px] text-white/50 uppercase">Longevity</div>
              <div class="text-xs text-white/70">Dry-down • durability</div>
            </div>
          </div>

          <p class="mt-3 text-xs text-white/50">Interactive constellation: moves with cursor and reflects quiz progress. Hover to explore.</p>
        </div>
      </div>
    </main>

    <div class="w-full border-t border-white/6 py-4 relative z-10">
      <div class="marquee-wrap">
        <div class="marquee-inner text-white/30 px-6 text-xs font-mono uppercase tracking-widest">
          Saccharomyces Ferment • Maranta Arundinacea • Activated Charcoal • Lactobacillus • Magnesium Hydroxide • Shea Butter • Saccharomyces Ferment • Maranta Arundinacea • Activated Charcoal
        </div>
      </div>
    </div>
  </div>

  <!-- MANIFESTO (premium layout) -->
  <div id="manifesto-page" class="page-section">
    <div class="relative pt-28 pb-20 px-6">
      <div class="container mx-auto max-w-4xl text-center">
        <div class="glass-strong p-10 rounded-3xl">
          <div class="brand-tag mb-4">DEOS DIOS</div>
          <h1 class="text-4xl md:text-5xl font-serif mb-6">A manifesto for specificity</h1>
          <p class="text-white/70 max-w-3xl mx-auto mb-6">Luxury in hygiene means precision. Not louder marketing — quieter mastery. We design around biology, not persuasion.</p>

          <div class="grid md:grid-cols-3 gap-6 text-left mt-8">
            <div>
              <h3 class="text-lg font-medium text-white/90 mb-2">Precision</h3>
              <p class="text-white/70">Your sweat is a data stream. We map it across six axes and translate it into action — not slogans.</p>
            </div>
            <div>
              <h3 class="text-lg font-medium text-white/90 mb-2">Integrity</h3>
              <p class="text-white/70">We prioritize safety, transparency, and honest efficacy. Ingredients are chosen for biology first, aroma second.</p>
            </div>
            <div>
              <h3 class="text-lg font-medium text-white/90 mb-2">Craft</h3>
              <p class="text-white/70">Curated formulations at every tier. From accessible performance to modern olfactory luxury.</p>
            </div>
          </div>

          <div class="mt-8">
            <p class="text-white/60 italic">“Your chemistry is unique. Your solution should be too.”</p>
          </div>

          <div class="mt-8">
            <button onclick="showPage('protocol')" class="px-6 py-3 rounded-full text-sm font-medium" style="background: linear-gradient(180deg,var(--gold), #d4b379); color:black;">Begin Your Profile</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- PROTOCOL / QUIZ PAGE -->
  <div id="protocol-page" class="page-section">
    <div class="relative pt-24 pb-20 px-6">
      <div class="container mx-auto max-w-3xl">
        <div class="text-center mb-6">
          <h1 class="text-4xl md:text-5xl font-serif text-white mb-2">The Protocol — 6-Axis Odor Genome</h1>
          <p class="text-white/50">28 targeted questions. Multi-select where noted. Your profile refines our learning engine.</p>
        </div>

        <div class="mb-4">
          <div class="progress-track w-full rounded-full"><div id="progressBar" class="progress-fill"></div></div>
          <div id="progressText" class="text-xs text-white/40 mt-2 text-center">Question 1 of 28</div>
        </div>

        <div id="quizContainer"></div>

        <div class="flex justify-between mt-8 gap-4">
          <button id="prevBtn" onclick="prevQ()" class="px-6 py-3 rounded-full text-sm font-medium text-white/70 border border-white/10" disabled>Previous</button>
          <div class="flex-1 flex justify-center">
            <button id="nextBtn" onclick="nextQ()" class="px-6 py-3 rounded-full text-sm font-medium text-white/70 border border-white/10">Next</button>
            <button id="finishBtn" onclick="finishQuiz()" class="px-8 py-3 rounded-full text-sm font-medium text-black ml-4" style="background: linear-gradient(180deg,var(--gold), #d4b379); display:none;">View Results</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- RESULTS -->
  <div id="results-page" class="page-section">
    <div class="relative pt-36 pb-20 px-6">
      <div class="container mx-auto max-w-6xl">
        <div class="text-center mb-8">
          <h1 class="text-4xl md:text-6xl font-serif text-white mb-2">Your Odor Genome Signature™</h1>
          <p class="text-white/50">Insights and three curated matches — luxury, performance, and value.</p>
        </div>

        <div id="resultsContent"></div>

        <div class="text-center mt-8 flex flex-col sm:flex-row gap-4 justify-center">
          <button onclick="showPage('protocol'); startQuiz()" class="px-6 py-3 rounded-full border border-white/10 text-white/70">Retake Protocol</button>
          <button id="exportBtn" onclick="exportResultImage()" class="px-6 py-3 rounded-full bg-ddgold text-black">Export & Share</button>
        </div>
      </div>
    </div>
  </div>

  <!-- FAQ -->
  <div id="faq-page" class="page-section">
    <div class="relative pt-36 pb-20 px-6">
      <div class="container mx-auto max-w-4xl">
        <h1 class="text-4xl md:text-6xl font-serif text-white mb-8 tracking-tight text-center">Frequently Asked Questions</h1>

        <div class="space-y-4">
          <details class="group bg-white/5 border border-white/10 rounded-lg open:bg-white/10">
            <summary class="p-6 text-base font-medium">What is the Odor Genome Protocol™?</summary>
            <div class="px-6 pb-6 text-sm text-white/60">A 6-axis diagnostic that maps your biological, environmental, and behavioral signals into a reproducible odor signature. This signature powers matched product recommendations across multiple price tiers.</div>
          </details>

          <details class="group bg-white/5 border border-white/10 rounded-lg open:bg-white/10">
            <summary class="p-6 text-base font-medium">How accurate are the recommendations?</summary>
            <div class="px-6 pb-6 text-sm text-white/60">We start with literature-backed factors (diet, genetics proxies, microbiome correlates). Accuracy improves as users provide feedback. Think of the system as a diagnostic that becomes smarter with scale.</div>
          </details>

          <details class="group bg-white/5 border border-white/10 rounded-lg open:bg-white/10">
            <summary class="p-6 text-base font-medium">Why do some deodorants “turn” on my skin?</summary>
            <div class="px-6 pb-6 text-sm text-white/60">Turning happens when ingredients chemically react with your sweat, producing new volatiles. Our engine filters formulas likely to change character on similar profiles.</div>
          </details>

          <details class="group bg-white/5 border border-white/10 rounded-lg open:bg-white/10">
            <summary class="p-6 text-base font-medium">Do you sell deodorants?</summary>
            <div class="px-6 pb-6 text-sm text-white/60">Not yet. We currently match you to existing products. Long-term we’ll produce bespoke formulations based on aggregated anonymized data.</div>
          </details>

          <details class="group bg-white/5 border border-white/10 rounded-lg open:bg-white/10">
            <summary class="p-6 text-base font-medium">Are the products safe for sensitive skin?</summary>
            <div class="px-6 pb-6 text-sm text-white/60">Yes — when your profile indicates sensitivity we prioritize baking-soda-free and low-irritant options. We flag likely irritants before suggesting formulas.</div>
          </details>

          <details class="group bg-white/5 border border-white/10 rounded-lg open:bg-white/10">
            <summary class="p-6 text-base font-medium">How long before a deodorant "works"?</summary>
            <div class="px-6 pb-6 text-sm text-white/60">Clinical antiperspirants can act within 24–72 hours (night application recommended). Transitioning to natural products may take 2–4 weeks as your skin microbiome adapts.</div>
          </details>

          <details class="group bg-white/5 border border-white/10 rounded-lg open:bg-white/10">
            <summary class="p-6 text-base font-medium">Can I retake the protocol later?</summary>
            <div class="px-6 pb-6 text-sm text-white/60">Yes. Life changes (meds, diet, hormones, climate) will shift your signature. Retake whenever you want updated matches.</div>
          </details>

          <details class="group bg-white/5 border border-white/10 rounded-lg open:bg-white/10">
            <summary class="p-6 text-base font-medium">Is my data private?</summary>
            <div class="px-6 pb-6 text-sm text-white/60">Yes. Profiles are anonymous by default. We use aggregated, anonymized data to improve the system. We don’t sell individual profiles.</div>
          </details>

          <details class="group bg-white/5 border border-white/10 rounded-lg open:bg-white/10">
            <summary class="p-6 text-base font-medium">Do you include clinical options?</summary>
            <div class="px-6 pb-6 text-sm text-white/60">Yes — clinical antiperspirants and dermatologist-grade options appear when profiles indicate severe sweating or medical-grade need.</div>
          </details>

          <details class="group bg-white/5 border border-white/10 rounded-lg open:bg-white/10">
            <summary class="p-6 text-base font-medium">Why would I pay for this?</summary>
            <div class="px-6 pb-6 text-sm text-white/60">This is a diagnostic product with tangible ROI: avoid wasted purchases, reduce social friction, and gain a shareable identity around personal hygiene. Utility + status.</div>
          </details>

          <details class="group bg-white/5 border border-white/10 rounded-lg open:bg-white/10">
            <summary class="p-6 text-base font-medium">What if the recommended product isn't available?</summary>
            <div class="px-6 pb-6 text-sm text-white/60">We provide multiple picks across tiers and explain why each alternative works so you can pick confidently.</div>
          </details>

          <details class="group bg-white/5 border border-white/10 rounded-lg open:bg-white/10">
            <summary class="p-6 text-base font-medium">How do I give feedback if something fails?</summary>
            <div class="px-6 pb-6 text-sm text-white/60">Return to your profile after trying a product and flag the result. Your feedback reweights our mapping for similar signatures.</div>
          </details>
        </div>
      </div>
    </div>
  </div>

  <!-- FOOTER -->
  <footer class="bg-black pt-12 pb-8 border-t border-white/10 text-center relative z-10">
    <div class="container mx-auto max-w-7xl px-6">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-12 mb-12">
        <div>
          <div class="flex items-center gap-2 mb-4 justify-center md:justify-start">
            <span class="iconify text-white" data-icon="lucide:sparkles"></span>
            <span class="text-sm font-serif italic">DEOS DIOS</span>
          </div>
          <p class="text-xs text-white/40 max-w-[220px] mx-auto md:mx-0">Optimizing hygiene through data-driven discovery and premium curation.</p>
        </div>

        <div>
          <h4 class="text-xs font-medium text-white mb-4 uppercase tracking-wider">Discover</h4>
          <ul class="space-y-2">
            <li><a href="#protocol" onclick="showPage('protocol')" class="text-xs text-white/40 hover:text-white">Protocol</a></li>
            <li><a href="#manifesto" onclick="showPage('manifesto')" class="text-xs text-white/40 hover:text-white">Manifesto</a></li>
          </ul>
        </div>

        <div>
          <h4 class="text-xs font-medium text-white mb-4 uppercase tracking-wider">Company</h4>
          <ul class="space-y-2">
            <li><a href="#faq" onclick="showPage('faq')" class="text-xs text-white/40 hover:text-white">FAQ</a></li>
            <li><a href="#" class="text-xs text-white/40 hover:text-white">Contact</a></li>
          </ul>
        </div>

        <div>
          <h4 class="text-xs font-medium text-white mb-4 uppercase tracking-wider">Social</h4>
          <div class="flex gap-4 justify-center md:justify-start">
            <a href="https://instagram.com/deosdios" target="_blank" class="text-white/40 hover:text-white"><span class="iconify" data-icon="lucide:instagram"></span></a>
            <a href="https://www.tiktok.com/@deosdios" target="_blank" class="text-white/40 hover:text-white"><span class="iconify" data-icon="lucide:video"></span></a>
          </div>
        </div>
      </div>

      <div class="border-t border-white/5 pt-8">
        <span class="text-[10px] text-white/20 font-mono">© 2025 DEOS DIOS. ALL RIGHTS RESERVED.</span>
      </div>
    </div>
  </footer>

  <!-- ================= SCRIPTS ================= -->
  <script>
  /***********************
   * ROUTING + NAV
   ***********************/
  function showPage(name, skipHash){
    const valid = ['home','protocol','manifesto','results','faq'];
    if(!valid.includes(name)) name='home';
    document.querySelectorAll('.page-section').forEach(s=>s.classList.remove('active'));
    const el = document.getElementById(name+'-page');
    if(el) el.classList.add('active');
    if(!skipHash) history.replaceState(null,'','#'+name);
    window.scrollTo({top:0,behavior:'smooth'});
    if(name==='protocol') startQuiz();
  }
  window.addEventListener('load', ()=> {
    const h = location.hash.replace('#','') || 'home';
    showPage(h, true);
  });
  window.addEventListener('hashchange', ()=> {
    const h = location.hash.replace('#','') || 'home';
    showPage(h, true);
  });

  /***********************
   * CONSTELLATION VISUAL
   * Interactive canvas that responds to mouse and quiz progress
   ***********************/
  (function(){
    const canvas = document.getElementById('constellation');
    const ctx = canvas.getContext('2d');
    let w=0,h=0, particles=[];
    const settings = {count: 22, maxR: 3, linkDist: 160};
    function resize(){ w = canvas.width = canvas.clientWidth * devicePixelRatio; h = canvas.height = 360 * devicePixelRatio; ctx.scale(devicePixelRatio, devicePixelRatio); }
    function rand(min,max){ return Math.random()*(max-min)+min; }
    function initParticles(){
      particles = [];
      for(let i=0;i<settings.count;i++){
        particles.push({
          x: rand(20, canvas.clientWidth-20),
          y: rand(20, 320),
          vx: rand(-0.3,0.3),
          vy: rand(-0.2,0.2),
          r: rand(1.6, 3.6),
          baseR: rand(1.6,3.6),
          hue: Math.random()*40 + 30
        });
      }
    }
    let mouse = {x:-9999,y:-9999};
    canvas.addEventListener('mousemove', e => { const rect = canvas.getBoundingClientRect(); mouse.x = e.clientX - rect.left; mouse.y = e.clientY - rect.top; });
    canvas.addEventListener('mouseleave', ()=>{ mouse.x=-9999; mouse.y=-9999; });
    function frame(){
      ctx.clearRect(0,0,canvas.width,canvas.height);
      // draw links
      for(let i=0;i<particles.length;i++){
        for(let j=i+1;j<particles.length;j++){
          const a = particles[i], b = particles[j];
          const dx = a.x - b.x, dy = a.y - b.y; const d = Math.sqrt(dx*dx + dy*dy);
          if(d < settings.linkDist){
            const alpha = 1 - (d / settings.linkDist);
            ctx.strokeStyle = `rgba(197,164,103,${alpha*0.12})`;
            ctx.lineWidth = 1;
            ctx.beginPath(); ctx.moveTo(a.x,a.y); ctx.lineTo(b.x,b.y); ctx.stroke();
          }
        }
      }
      // update & draw nodes
      particles.forEach(p=>{
        p.x += p.vx; p.y += p.vy;
        if(p.x < 6 || p.x > canvas.clientWidth-6) p.vx *= -1;
        if(p.y < 6 || p.y > 320) p.vy *= -1;
        // mouse attraction
        const dx = (mouse.x - p.x), dy = (mouse.y - p.y);
        const md = Math.sqrt(dx*dx + dy*dy);
        if(md < 120){
          p.x -= dx*0.02; p.y -= dy*0.02;
          p.r = Math.min(7, p.baseR + (120 - md)/30);
        } else {
          p.r = Math.max(p.baseR, p.r - 0.02);
        }
        // draw
        const grd = ctx.createRadialGradient(p.x,p.y,p.r*0.2,p.x,p.y,p.r*2.5);
        grd.addColorStop(0, `rgba(197,164,103,0.95)`);
        grd.addColorStop(1, `rgba(197,164,103,0.02)`);
        ctx.fillStyle = grd;
        ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fill();
      });
      requestAnimationFrame(frame);
    }
    function start(){ resize(); initParticles(); frame(); }
    window.addEventListener('resize', ()=>{ resize(); initParticles(); });
    // expose a small API to update nodes size by progress (0-1)
    window.constellationSetProgress = function(progress){
      particles && particles.forEach((p,i)=> { p.r = p.baseR + progress*2.6; });
    };
    start();
  })();

  /***********************
   * PRODUCTS DATA
   ***********************/
  const products = [
    // luxury / premium
    {id:'saltstone_santal', name:'Salt & Stone — Santal & Vetiver', tier:'luxury', attrs:['woods','long_wear','natural','sulfur_fighting'], blurb:'Warm, resinous woods that help neutralize strong sulfur notes while offering elegant longevity.'},
    {id:'aesop_herbal', name:'Aesop — Herbal Roll-On', tier:'luxury', attrs:['earthy','antimicrobial','natural'], blurb:'Botanical actives paired with zinc derivatives for refined odor control.'},
    {id:'lelaboproto', name:'Le Labo-style — Custom Inspired', tier:'luxury', attrs:['fragrance','long_wear','refined'], blurb:'Olfactory-first formula designed for layered scent and premium tactile experience.'},
    // premium / mid
    {id:'lume_unscented', name:'Lume — Unscented (Mandelic)', tier:'mid', attrs:['sensitive','antimicrobial','natural'], blurb:'Acid-based antimicrobial solution (no baking soda) — ideal for sensitive users and sulfur issues.'},
    {id:'native_tech', name:'Native — Signature', tier:'mid', attrs:['fragrance','natural','balanced'], blurb:'Popular natural formula with a range of scent families; good for light-moderate needs.'},
    {id:'schmidts', name:"Schmidt's — Sensitive Charcoal", tier:'mid', attrs:['sensitive','earthy','natural'], blurb:'Charcoal and plant actives that suit many users transitioning from antiperspirants.'},
    // budget
    {id:'dove_adv', name:'Dove Advanced Care — Unscented', tier:'budget', attrs:['aluminum','long_wear','sensitive'], blurb:'Reliable, moisturizing antiperspirant for wide compatibility.'},
    {id:'mitchum', name:'Mitchum — Advanced Control', tier:'budget', attrs:['aluminum','long_wear'], blurb:'Drugstore clinical-style protection focused on wetness control.'},
    {id:'armhammer', name:'Arm & Hammer — Essentials', tier:'budget', attrs:['natural','baking_soda'], blurb:'Value option with effective deodorizing ingredients (may be baking soda-based).'},
    // clinical
    {id:'certain_dri', name:'Certain Dri — Clinical Strength', tier:'clinical', attrs:['aluminum','long_wear'], blurb:'Topical aluminum chloride for severe perspiration control; use per instructions.'},
    {id:'vanicream', name:'Vanicream — Clinical Fragrance Free', tier:'clinical', attrs:['sensitive','aluminum'], blurb:'Dermatologist-grade formula for highly reactive skin.'},
    {id:'degree_sport', name:'Degree — MotionSense Sport', tier:'mid', attrs:['sport','long_wear','aluminum'], blurb:'Motion-activated protection for athletes and high activity days.'}
  ];

  /***********************
   * QUESTIONS (28)
   * - multi: boolean (allow multi-select)
   * - note: primary_concern is multi-select now
   ***********************/
  const questions = [
    // Biology (6)
    {id:'age', q:'What is your age range?', why:'Hormonal shifts affect sweat and scent', opts:['Under 18','18-25','26-35','36-45','46-55','56+'], multi:false},
    {id:'sex', q:'Biological sex assigned at birth?', why:'Hormonal differences influence sweat composition', opts:['Male','Female','Prefer not to say'], multi:false},
    {id:'earwax', q:'Which best describes your earwax?', why:'Dry earwax is a genetic proxy (ABCC11) linked to lower odor production', opts:['Dry / flaky','Wet / sticky','Not sure'], multi:false},
    {id:'skin_moist', q:'How would you describe underarm skin?', why:'Oily, dry, or sensitive skin affects ingredient interaction', opts:['Very dry','Normal','Oily','Sensitive (reacts easily)'], multi:false},
    {id:'hair_density', q:'Underarm hair density?', why:'Hair affects bacterial habitat and scent retention', opts:['Shaved / none','Sparse','Moderate','Dense'], multi:false},
    {id:'stress_reactive', q:'Do you experience sudden sweat when stressed (social/presentation)?', why:'Apocrine sweat from stress smells different', opts:['Yes often','Sometimes','Rarely','Never'], multi:false},

    // Sweat & timing (5)
    {id:'sweat_amount', q:'How much do you typically sweat in a normal day?', why:'Overall sweat volume guides wetness vs odor strategy', opts:['Barely','Light','Moderate','Heavy','Excessive'], multi:false},
    {id:'sweat_triggers', q:'What triggers your sweat? (select all that apply)', why:'Different triggers imply different sweat chemistries', opts:['Exercise','Heat/humidity','Emotional stress','Spicy foods','After certain meals','No clear trigger'], multi:true},
    {id:'odor_onset', q:'When do you typically begin to notice odor during your day?', why:'How quickly odor appears indicates bacterial activity and product durability needed', opts:['Within 1–3 hours of starting day','By midday (4–6 hours)','Late afternoon/evening','Only after heavy exercise','Rarely/never'], multi:false},
    {id:'shirt_evidence', q:'What do your shirts typically show after a day? (select all)', why:'Visual residue reveals product & sweat interaction', opts:['Yellow pit staining','White crusty residue','Stiff fabric','Only discoloration','Shirts stay relatively clean'], multi:true},
    {id:'odor_cycle', q:'Does your odor change during hormonal cycles or medication changes?', why:'Hormones and meds can shift scent chemistry', opts:['Yes','Sometimes','No','Not applicable'], multi:false},

    // Diet & lifestyle (5)
    {id:'diet_type', q:'Which best describes your typical diet?', why:'Food metabolites (sulfur, etc.) affect sweat volatiles', opts:['Heavy meat','Balanced mixed','Pescatarian','Vegetarian','Vegan','Low-carb/Keto'], multi:false},
    {id:'diet_specifics', q:'Which of these do you consume regularly? (select all)', why:'Certain foods introduce sulfur or volatiles', opts:['Garlic / onions','Cruciferous veggies (broccoli, cabbage)','Red meat frequently','Alcohol 3+ times/week','Coffee every day','None of these'], multi:true},
    {id:'activity_level', q:'How active are you on an average week?', why:'Activity affects sweat volume and product wear', opts:['Sedentary','Light (1–2x/week)','Moderate (2–3x/week)','Very active (4–5x/week)','Athlete (daily intense)'], multi:false},
    {id:'work_env', q:'Where do you spend most of your day?', why:'Climate and ventilation influence sweat behavior', opts:['Indoors / air-conditioned','Mostly outdoors','Physical / hot worksite','Office / hybrid','Variable'], multi:false},
    {id:'laundry', q:'How often do you launder shirts you sweat in?', why:'Residual buildup alters smell', opts:['Daily','Every 2 days','Weekly','Less often'], multi:false},

    // Product history (4)
    {id:'current_type', q:'What product category do you currently use?', why:'Understanding what you currently rely upon helps us avoid repeats', opts:['Antiperspirant (reduces sweat)','Deodorant only (no aluminum)','Natural deodorant (no aluminum)','Clinical product (prescription strength)','No product regularly'], multi:false},
    {id:'natural_experience', q:'If you tried natural deodorants, what was the result?', why:'Transition and irritation data are critical', opts:['Worked well','Caused irritation','Mixed results','Never tried'], multi:false},
    {id:'past_failures', q:'Problems you have experienced with deodorants? (select all)', why:'Signals to avoid certain ingredients or formats', opts:['Rash / irritation','Itching / burning','Didn’t stop odor','Didn’t stop wetness','Stains / residue','Stopped working over time','No major issues'], multi:true},
    {id:'reapplication', q:'How often would you be willing to reapply if it meant better results?', why:'Willingness to reapply changes recommended formats', opts:['Never / once a day max','Twice a day','Whenever needed','I don’t mind frequent reapplication'], multi:false},

    // Scent identity (4)
    {id:'scent_families', q:'Which scent families do you prefer? (select all)', why:'We’ll avoid mismatched fragrances', opts:['Resinous / Woody','Citrus / Green','Mineral / Clean','Herbal / Sharp','Gourmand / Sweet','Floral / Delicate'], multi:true},
    {id:'scent_projection', q:'How much scent projection do you prefer?', why:'Projection shapes fragrance architecture', opts:['None / unscented','Very subtle','Moderate','Pronounced'], multi:false},
    {id:'experimental', q:'Do you enjoy experimental / unusual scents?', why:'Allows for wildcard premium suggestions', opts:['Love them','Open to them','Prefer classics','Avoid unusual scents'], multi:false},
    {id:'avoid_ingredients', q:'Any ingredients you avoid? (select all)', why:'Allergies & values — we respect them', opts:['Aluminum','Baking soda','Essential oils','Synthetic fragrance','None'], multi:true},

    // Longevity & climate (4)
    {id:'primary_concern', q:'Select your primary concerns (select all that apply)', why:'What matters most — pick multiple if relevant', opts:['Stop odor completely','Reduce wetness / sweating','Both equally','Gentle on sensitive skin','Long-lasting protection','Natural / clean ingredients'], multi:true},
    {id:'climate_type', q:'Which best describes your local climate?', why:'Humidity and heat materially affect product performance', opts:['Hot & humid','Hot & dry','Temperate / mild','Cold / dry','Seasonal / variable'], multi:false},
    {id:'indoor_outdoor', q:'Where do you spend most of your active hours?', why:'Indoor vs outdoor affects product selection', opts:['Mostly indoors (AC / climate control)','Mostly outdoors','Even split'], multi:false},
    {id:'budget', q:'What is your typical budget per deodorant?', why:'Helps us match within price comfort', opts:['Under $8','$8–$15','$15–$25','$25–$40','$40+'], multi:false}
  ];

  /***********************
   * Mapping heuristics (answer -> attributes)
   ***********************/
  const mapping = {
    'diet_specifics': {
      'Garlic / onions': {sulfur_fighting:2, antimicrobial:1},
      'Cruciferous veggies (broccoli, cabbage)': {sulfur_fighting:1},
      'Red meat frequently': {sulfur_fighting:1},
      'Alcohol 3+ times/week': {sulfur_fighting:1},
      'Coffee every day': {fragrance:1}
    },
    'sweat_triggers': {
      'Exercise': {sport:2, long_wear:1},
      'Heat/humidity': {long_wear:1},
      'Emotional stress': {antimicrobial:2, fragrance:1},
      'Spicy foods': {sulfur_fighting:1},
      'After certain meals': {sulfur_fighting:1}
    },
    'shirt_evidence': {
      'Yellow pit staining': {aluminum:1},
      'White crusty residue': {baking_soda:1},
      'Stiff fabric': {long_wear:1}
    },
    'past_failures': {
      'Rash / irritation': {sensitive:2, baking_soda:-3},
      'Itching / burning': {sensitive:2, baking_soda:-3}
    },
    'current_type': {
      'Antiperspirant (reduces sweat)': {aluminum:1},
      'Deodorant only (no aluminum)': {natural:1},
      'Natural deodorant (no aluminum)': {natural:1},
      'Clinical product (prescription strength)': {aluminum:2}
    },
    'activity_level': {
      'Very active (4–5x/week)': {sport:2, long_wear:1},
      'Athlete (daily intense)': {sport:3, long_wear:2}
    },
    'scent_families': {
      'Resinous / Woody': {woods:2},
      'Citrus / Green': {citrus:2},
      'Mineral / Clean': {mineral:2},
      'Herbal / Sharp': {herbal:2},
      'Gourmand / Sweet': {sweet:2},
      'Floral / Delicate': {floral:2}
    },
    'primary_concern': {
      'Stop wetness / sweating': {aluminum:3},
      'Reduce wetness / sweating': {aluminum:2},
      'Stop odor completely': {antimicrobial:3, sulfur_fighting:2},
      'Natural / clean ingredients': {natural:3},
      'Gentle on sensitive skin': {sensitive:3},
      'Long-lasting protection': {long_wear:2}
    },
    'avoid_ingredients': {
      'Aluminum': {aluminum:-6},
      'Baking soda': {baking_soda:-6}
    },
    'climate_type': {
      'Hot & humid': {long_wear:2},
      'Hot & dry': {long_wear:1},
      'Seasonal / variable': {long_wear:1}
    },
    'indoor_outdoor': {
      'Mostly outdoors': {long_wear:1},
      'Mostly indoors (AC / climate control)': {}
    }
  };

  /***********************
   * QUIZ ENGINE
   ***********************/
  let currentQ = 0;
  let answers = {}; // key -> value or array if multi
  function startQuiz(){
    currentQ = 0;
    answers = {};
    questions.forEach(q => { if(q.multi) answers[q.id] = []; });
    renderQuestion();
    document.getElementById('prevBtn').disabled = true;
    document.getElementById('finishBtn').style.display = 'none';
    document.getElementById('nextBtn').style.display = 'inline-block';
    // reset constellation progress
    window.constellationSetProgress && window.constellationSetProgress(0);
  }

  function renderQuestion(){
    const q = questions[currentQ];
    const total = questions.length;
    const progress = Math.round(((currentQ+1) / total) * 100);
    document.getElementById('progressBar').style.width = progress + '%';
    document.getElementById('progressText').textContent = `Question ${currentQ+1} of ${total}`;
    // build options
    const optsHtml = q.opts.map(opt => {
      const safe = opt.replace(/'/g,"\\'");
      if(q.multi){
        const checked = (Array.isArray(answers[q.id]) && answers[q.id].includes(opt)) ? 'selected' : '';
        return `<button onclick="toggleMulti('${q.id}','${safe}', this)" class="option-btn w-full ${checked}">${opt}</button>`;
      } else {
        const checked = (answers[q.id]===opt) ? 'selected' : '';
        return `<button onclick="selectSingle('${q.id}','${safe}', this)" class="option-btn w-full ${checked}">${opt}</button>`;
      }
    }).join('');
    document.getElementById('quizContainer').innerHTML = `
      <div class="glass p-6 rounded-2xl">
        <h3 class="text-xl font-medium mb-2">${q.q}</h3>
        <p class="text-sm italic text-white/50 mb-4">Why we ask: ${q.why}</p>
        <div class="space-y-3">${optsHtml}</div>
      </div>
    `;
    document.getElementById('prevBtn').disabled = currentQ===0;
    document.getElementById('nextBtn').style.display = (currentQ < questions.length-1) ? 'inline-block' : 'none';
    document.getElementById('finishBtn').style.display = (currentQ === questions.length-1) ? 'inline-block' : 'none';
    // update constellation to mirror progress visually
    window.constellationSetProgress && window.constellationSetProgress((currentQ+1)/questions.length);
  }

  function selectSingle(id, val, btn){
    answers[id] = val;
    // visual
    document.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected'));
    btn.classList.add('selected');
    // small delay to advance
    setTimeout(()=> { if(currentQ < questions.length - 1) { currentQ++; renderQuestion(); } else { document.getElementById('finishBtn').style.display='inline-block'; } }, 180);
  }

  function toggleMulti(id, val, btn){
    if(!Array.isArray(answers[id])) answers[id] = [];
    const idx = answers[id].indexOf(val);
    if(idx === -1) answers[id].push(val); else answers[id].splice(idx,1);
    // update visuals
    const parent = btn.closest('.space-y-3');
    if(parent){
      parent.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected'));
      (answers[id] || []).forEach(v => {
        parent.querySelectorAll('.option-btn').forEach(b => { if(b.textContent.trim()===v) b.classList.add('selected'); });
      });
    }
  }

  function nextQ(){
    const q = questions[currentQ];
    // require selection
    if(q.multi){
      if(!Array.isArray(answers[q.id]) || answers[q.id].length === 0){ flashFirstOption(); return; }
    } else {
      if(!answers[q.id]){ flashFirstOption(); return; }
    }
    if(currentQ < questions.length - 1) { currentQ++; renderQuestion(); }
  }

  function prevQ(){ if(currentQ > 0){ currentQ--; renderQuestion(); } }

  function flashFirstOption(){
    const btn = document.querySelector('.option-btn');
    if(btn) btn.animate([{opacity:1},{opacity:0.4},{opacity:1}], {duration: 320});
  }

  /***********************
   * SCORING & MATCHING
   ***********************/
  function scoreProfile(){
    const attrScores = {};
    const keys = ['antimicrobial','aluminum','baking_soda','sensitive','sport','fragrance','natural','woods','citrus','mineral','herbal','sweet','floral','sulfur_fighting','long_wear'];
    keys.forEach(k => attrScores[k] = 0);

    // iterate answers
    for(const [qid, val] of Object.entries(answers)){
      if(Array.isArray(val)){
        val.forEach(v => {
          if(mapping[qid] && mapping[qid][v]){
            Object.entries(mapping[qid][v]).forEach(([k,w]) => attrScores[k] = (attrScores[k]||0) + w);
          }
        });
      } else if(typeof val === 'string'){
        const v = val;
        if(mapping[qid] && mapping[qid][v]){
          Object.entries(mapping[qid][v]).forEach(([k,w]) => attrScores[k] = (attrScores[k]||0) + w);
        }
      }
    }

    // additional heuristics
    if(answers.sweat_amount && (answers.sweat_amount.includes('Heavy') || answers.sweat_amount.includes('Excessive'))){
      attrScores.long_wear += 1; attrScores.aluminum += 1;
    }
    if(Array.isArray(answers.avoid_ingredients) && answers.avoid_ingredients.includes('Aluminum')) attrScores.aluminum -= 6;
    if(Array.isArray(answers.avoid_ingredients) && answers.avoid_ingredients.includes('Baking soda')) attrScores.baking_soda -= 6;
    if(Array.isArray(answers.scent_families) && answers.scent_families.includes('Resinous / Woody')) attrScores.woods += 2;

    return attrScores;
  }

  function matchProducts(attrScores){
    // compute score per product
    const scored = products.map(p => {
      let s = 0;
      p.attrs.forEach(attr => s += (attrScores[attr] || 0));
      // favor matching tiers modestly
      s += p.tier==='luxury' ? 0.15 : p.tier==='mid' ? 0.08 : 0;
      return {product: p, score: s};
    });

    // group and pick top 3 per overall buckets
    const byTier = {luxury:[], mid:[], budget:[], clinical:[]};
    scored.forEach(item => {
      byTier[item.product.tier] ? byTier[item.product.tier].push(item) : (byTier.clinical.push(item));
    });
    Object.keys(byTier).forEach(k => byTier[k].sort((a,b) => b.score - a.score));
    const pickThree = (arr, fallbackIds) => {
      const picks = [];
      for(let i=0;i<3 && (i < arr.length); i++) picks.push(arr[i].product);
      // fill with fallbacks if needed
      if(picks.length < 3){
        fallbackIds.forEach(fid => { if(picks.length<3){ const f = products.find(p=>p.id===fid); if(f && !picks.find(x=>x.id===f.id)) picks.push(f); } });
      }
      return picks;
    };

    const luxury = pickThree(byTier.luxury, ['saltstone_santal','aesop_herbal','lelaboproto']);
    const mid = pickThree(byTier.mid, ['lume_unscented','native_tech','schmidts']);
    const budget = pickThree(byTier.budget, ['dove_adv','mitchum','armhammer']);
    const clinical = byTier.clinical.length ? byTier.clinical[0].product : (byTier.mid[0] ? byTier.mid[0].product : null);

    return {luxury, mid, budget, clinical};
  }

  function buildRationale(product, attrScores){
    const reasons = [];
    if(attrScores.sulfur_fighting > 1) reasons.push('Your profile indicates exposure to sulfur-rich metabolites; picks that neutralize thiols and reduce pH help.');
    if(attrScores.antimicrobial > 1) reasons.push('Rapid onset suggests active bacteria — antimicrobial or enzyme-based formulas are recommended.');
    if(attrScores.long_wear > 1) reasons.push('You need durability — long-wear or clinical options are recommended.');
    if(attrScores.sensitive > 1) reasons.push('You reported sensitivity — low-irritant, baking-soda-free options are safer.');
    if(attrScores.sport > 1) reasons.push('High activity recommends sport-focused protection.');
    if(attrScores.natural > 1) reasons.push('Preference for cleaner ingredients — plant-derived actives or acid-based systems suggested.');

    return `${product.blurb} ${reasons.length ? 'Why this matches: ' + reasons.join(' ') : ''}`;
  }

  /***********************
   * FINISH + RENDER RESULTS
   ***********************/
  function finishQuiz(){
    const lastQ = questions[currentQ];
    if(lastQ.multi){
      if(!Array.isArray(answers[lastQ.id]) || answers[lastQ.id].length===0){ alert('Please answer the final question.'); return; }
    } else {
      if(!answers[lastQ.id]){ alert('Please answer the final question.'); return; }
    }

    const attrScores = scoreProfile();
    const matches = matchProducts(attrScores);

    // build insights
    const insights = [];
    if(answers.earwax && answers.earwax.includes('Dry')) insights.push('Earwax pattern suggests an ABCC11 variant, which often correlates with lower body odor production.');
    if(Array.isArray(answers.diet_specifics) && answers.diet_specifics.includes('Garlic / onions')) insights.push('Diet includes sulfur-rich foods (garlic/onions) which can increase thiol-based odor.');
    if(answers.odor_onset && answers.odor_onset.includes('Within 1–3 hours')) insights.push('Rapid odor onset suggests active skin bacteria; antimicrobial strategies may help.');
    if(Array.isArray(answers.past_failures) && answers.past_failures.includes('Rash / irritation')) insights.push('Reported skin reactions — avoid baking-soda-heavy products.');

    // render
    const el = document.getElementById('resultsContent');
    el.innerHTML = `
      <div class="grid md:grid-cols-3 gap-6 mb-6">
        <div class="glass p-6 rounded-2xl text-center">
          <div class="text-2xl font-light mb-1">${answers.sweat_amount || 'Moderate'}</div>
          <div class="text-xs text-white/50 uppercase tracking-wider">Sweat Level</div>
        </div>
        <div class="glass p-6 rounded-2xl text-center">
          <div class="text-2xl font-light mb-1">${answers.odor_onset || 'Typical'}</div>
          <div class="text-xs text-white/50 uppercase tracking-wider">Odor Onset</div>
        </div>
        <div class="glass p-6 rounded-2xl text-center">
          <div class="text-2xl font-light mb-1">${answers.skin_moist || 'Normal'}</div>
          <div class="text-xs text-white/50 uppercase tracking-wider">Skin Type</div>
        </div>
      </div>

      ${insights.length ? `<div class="mb-6"><h3 class="text-xl font-medium mb-3">Key Insights</h3><div class="space-y-3">${insights.map(i => `<div class="border-l-2 border-white/30 pl-4 py-2 text-white/70">${i}</div>`).join('')}</div></div>` : ''}

      <h3 class="text-2xl font-serif mb-4">Top Matches</h3>
      <div class="grid md:grid-cols-3 gap-6">
        ${renderMatchCol(matches.luxury, 'Luxury — Top Picks', attrScores)}
        ${renderMatchCol(matches.mid, 'Performance — High Fit', attrScores)}
        ${renderMatchCol(matches.budget, 'Value — Reliable Picks', attrScores)}
      </div>

      ${matches.clinical ? `<div class="mt-8"><h4 class="text-lg mb-2">Clinical Option</h4><div class="glass p-4 rounded-2xl"><strong>${matches.clinical.name}</strong><div class="text-white/70 mt-2">${matches.clinical.blurb}</div><div class="text-white/70 mt-3">${buildRationale(matches.clinical, attrScores)}</div></div></div>` : ''}
      <div id="radarExport" class="mt-8"></div>
    `;

    // store for export
    window._lastResult = {answers, attrScores, matches};
    showPage('results');
    // update constellation with 100% to indicate done
    window.constellationSetProgress && window.constellationSetProgress(1);
    setTimeout(()=> window.scrollTo({top:0,behavior:'smooth'}),120);
  }

  function renderMatchCol(list, header, attrScores){
    return `
      <div>
        <div class="text-xs text-white/40 mb-3">${header}</div>
        ${list.map((p, i) => `
          <div class="glass p-4 rounded-2xl mb-4">
            <div class="flex justify-between items-start mb-3">
              <div>
                <div class="text-sm text-white/60">${p.tier === 'luxury' ? 'Luxury' : p.tier === 'mid' ? 'Premium' : 'Budget'}</div>
                <strong class="text-lg block mt-1">${p.name}</strong>
                <div class="text-white/70 text-sm mt-1">${p.blurb}</div>
              </div>
            </div>
            <div class="text-white/70 mt-2">${buildRationale(p, attrScores)}</div>
            <div class="mt-4 flex gap-3">
              <a href="#" class="px-4 py-2 rounded-full bg-ddgold text-black text-sm font-medium">Shop</a>
              <button onclick="saveProfile('${p.id}')" class="px-4 py-2 rounded-full border border-white/10 text-sm">Save</button>
            </div>
          </div>
        `).join('')}
      </div>
    `;
  }

  function saveProfile(id){ alert('Saved: ' + id + ' (placeholder). Future versions can persist to account/email.'); }

  /***********************
   * EXPORT (PNG) — radar + summary
   ***********************/
  function exportResultImage(){
    const r = window._lastResult;
    if(!r){ alert('No results to export. Complete the protocol first.'); return; }
    // simple 6-axis mapping from attrScores
    const axes = {
      'BioChem': Math.min(92, Math.max(10, Math.round((r.attrScores.sulfur_fighting||0)*12 + (r.attrScores.antimicrobial||0)*9 + 28))),
      'Activity': Math.min(92, Math.max(10, Math.round((r.attrScores.sport||0)*14 + 18))),
      'Stress': Math.min(92, Math.max(10, Math.round((r.attrScores.antimicrobial||0)*10 + (r.attrScores.fragrance||0)*6 + 20))),
      'Environment': Math.min(92, Math.max(10, Math.round((r.attrScores.long_wear||0)*12 + 20))),
      'ScentAffinity': Math.min(92, Math.max(10, Math.round((r.attrScores.fragrance||0)*12 + (r.attrScores.woods||0)*6 + 20))),
      'Longevity': Math.min(92, Math.max(10, Math.round((r.attrScores.long_wear||0)*12 + 20)))
    };
    // canvas
    const canvas = document.createElement('canvas'); canvas.width = 1400; canvas.height = 1600;
    const ctx = canvas.getContext('2d');
    // background
    ctx.fillStyle = '#060606'; ctx.fillRect(0,0,canvas.width,canvas.height);
    // header
    ctx.fillStyle = '#D9CBA3'; ctx.font = '36px Inter'; ctx.fillText('DEOS DIOS — Odor Genome', 80, 80);
    ctx.fillStyle = '#fff'; ctx.font = '20px Inter'; ctx.fillText('Your Odor Genome Signature™', 80, 120);
    // radar
    const cx = 700, cy = 520, radius = 300;
    const names = Object.keys(axes);
    ctx.strokeStyle = 'rgba(255,255,255,0.06)'; ctx.lineWidth = 1;
    for(let s=1;s<=5;s++){
      ctx.beginPath();
      for(let i=0;i<names.length;i++){
        const angle = (Math.PI*2/names.length)*i - Math.PI/2;
        const rad = radius*(s/5);
        const x = cx + Math.cos(angle)*rad;
        const y = cy + Math.sin(angle)*rad;
        if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
      }
      ctx.closePath(); ctx.stroke();
    }
    // labels
    ctx.fillStyle = 'rgba(255,255,255,0.8)'; ctx.font = '16px Inter';
    names.forEach((n,i)=>{
      const angle = (Math.PI*2/names.length)*i - Math.PI/2;
      const x = cx + Math.cos(angle)*(radius+36);
      const y = cy + Math.sin(angle)*(radius+36);
      ctx.fillText(n, x - ctx.measureText(n).width/2, y + 6);
    });
    // polygon
    ctx.beginPath();
    const points=[];
    names.forEach((k,i)=>{
      const angle = (Math.PI*2/names.length)*i - Math.PI/2;
      const val = axes[k]/100;
      const x = cx + Math.cos(angle)*radius*val;
      const y = cy + Math.sin(angle)*radius*val;
      points.push([x,y]);
      if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
    });
    ctx.closePath();
    ctx.fillStyle = 'rgba(197,164,103,0.12)'; ctx.fill();
    ctx.strokeStyle = 'rgba(197,164,103,0.8)'; ctx.lineWidth = 2; ctx.stroke();
    points.forEach(p=>{ ctx.beginPath(); ctx.arc(p[0],p[1],6,0,Math.PI*2); ctx.fillStyle='#C5A467'; ctx.fill(); });

    // summary left
    ctx.fillStyle = '#fff'; ctx.font = '18px Inter'; ctx.fillText('Snapshot', 80, 580);
    ctx.font = '14px Inter';
    const lines = [
      'Sweat Level: ' + (r.answers.sweat_amount || 'Moderate'),
      'Primary concerns: ' + ((r.answers.primary_concern && r.answers.primary_concern.join(', ')) || 'Balanced'),
      'Activity: ' + (r.answers.activity_level || 'Moderate'),
      ''
    ];
    lines.forEach((ln,i)=> ctx.fillText(ln, 80, 610 + i*26));

    // product list right
    ctx.fillStyle = '#fff'; ctx.font = '18px Inter'; ctx.fillText('Top Matches', 80, 760);
    ctx.font = '14px Inter';
    const recs = [r.matches.luxury[0], r.matches.mid[0], r.matches.budget[0]];
    let y = 790;
    recs.forEach((p,idx)=>{
      ctx.fillStyle = '#fff'; ctx.font = '16px Inter'; ctx.fillText(`${idx+1}. ${p.name}`, 80, y);
      ctx.fillStyle = 'rgba(255,255,255,0.75)'; ctx.font = '13px Inter';
      const blurb = p.blurb.length > 110 ? p.blurb.slice(0,110) + '…' : p.blurb;
      ctx.fillText(blurb, 80, y+20);
      y += 66;
    });

    // footer small
    ctx.fillStyle='rgba(255,255,255,0.4)'; ctx.font='12px Inter'; ctx.fillText('DEOS DIOS — Odor Genome Protocol', 80, 1520);
    const link = document.createElement('a'); link.download = 'deosdios_result.png';
    link.href = canvas.toDataURL('image/png'); link.download = 'deosdios_result.png'; link.click();
  }

  /***********************
   * INIT: auto-start quiz if #protocol
   ***********************/
  if(location.hash.replace('#','')==='protocol'){ /* showPage handles startQuiz */ }

  // startQuiz on first load only when navigating to protocol
  window.startQuiz = startQuiz;
  window.saveProfile = saveProfile;
  window.exportResultImage = exportResultImage;
  </script>
</body>
</html>
